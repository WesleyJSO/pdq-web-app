use bd_qas_s3;

-- para permitir nova criptografia.
alter table usuario modify senha varchar(255);

-- GENERATED BY ORACLE SQL DEVELOPER DATA MODELER 18.3.0.268.1156
--   AT:        2019-02-27 11:56:04 BRT
--   SITE:      ORACLE DATABASE 11G
--   TYPE:      ORACLE DATABASE 11G



CREATE TABLE CONTROLE_APROVACAO (
    `ID`                           INT(7) NOT NULL,
    ID_STATUS_CONTROLE_APROVACAO   INT(7) NOT NULL,
    ID_PERFIL                      INT(4) NOT NULL,
    ID_REGRA                       INT(7) NOT NULL,
    ID_USUARIO                     INT(4) NOT NULL,
    DATA_APROVACAO                 DATE,
    ATIVO                          CHAR(1)
);
ALTER TABLE CONTROLE_APROVACAO ADD CONSTRAINT PK__CTR_APR PRIMARY KEY ( ID );


CREATE TABLE FLUXO_PEDIDO_DE_PARA (
    ID                      INT(7) NOT NULL,
    ID_STATUS_PEDIDO_DE     INT(7) NOT NULL,
    ID_STATUS_PEDIDO_PARA   INT(7) NOT NULL,
    BEAN_VALIDACAO          VARCHAR(50)
);
ALTER TABLE FLUXO_PEDIDO_DE_PARA ADD CONSTRAINT PK__FLX_PED_DE_PARA PRIMARY KEY ( ID );


CREATE TABLE PEDIDO_CONTROLE_APROVACAO (
    ID_PEDIDO               VARCHAR(50) CHARACTER SET ucs2 NOT NULL,
    ID_CONTROLE_APROVACAO   INT(7) NOT NULL
);
ALTER TABLE PEDIDO_CONTROLE_APROVACAO ADD CONSTRAINT PK__PED_CON_APR PRIMARY KEY ( ID_PEDIDO,
                                                                                   ID_CONTROLE_APROVACAO );

CREATE TABLE PERFIL_STATUS_PEDIDO (
    ID_PERFIL          INT(4) NOT NULL,
    ID_STATUS_PEDIDO   INT(7) NOT NULL
);
ALTER TABLE PERFIL_STATUS_PEDIDO ADD CONSTRAINT PK__PER_STS_PED PRIMARY KEY ( ID_STATUS_PEDIDO,
                                                                              ID_PERFIL );

CREATE TABLE REGRA (
    ID          INT(7) NOT NULL,
    DESCRICAO   VARCHAR(100),
    ATIVO       CHAR(1),
    APROVADO    CHAR(1)
);
ALTER TABLE REGRA ADD CONSTRAINT PK__RGR PRIMARY KEY ( ID );


CREATE TABLE REGRA_APROVACAO_COR (
    ID                  INT(7) NOT NULL,
    ID_COR              INT(7) NOT NULL,
    ID_PERFIL           INT(4) NOT NULL,
    PERCENTUAL_INICIO   INT(3),
    PERCENTUAL_FIM      INT(3)
);
ALTER TABLE REGRA_APROVACAO_COR ADD CONSTRAINT PK__RGR_APR_COR PRIMARY KEY ( ID );


CREATE TABLE REGRA_APROVACAO_PRAZO (
    ID              INT(7) NOT NULL,
    ID_PERFIL       INT(4) NOT NULL,
    NUM_DIAS_INI    INT(10),
    NUM_DIAS_FIM    INT(10),
    DT_INI          DATE,
    DT_FIM          DATE,
    STS_ATIVO       CHAR(1),
    DT_SICRONISMO   DATE,
    ID_USUARIO      INT(4) NOT NULL
);
ALTER TABLE REGRA_APROVACAO_PRAZO ADD CONSTRAINT PK_RGR_APR_PRZ PRIMARY KEY ( ID );


CREATE TABLE REGRA_APROVACAO_TABELA (
    ID   INT(7) NOT NULL
);
ALTER TABLE REGRA_APROVACAO_TABELA ADD CONSTRAINT PK__RGR_APR_TBL PRIMARY KEY ( ID );


CREATE TABLE STATUS_CONTROLE_APROVACAO (
    ID          INT(7) NOT NULL,
    DESCRICAO   VARCHAR(50)
);
COMMENT ON COLUMN STATUS_CONTROLE_APROVACAO.ID IS
'0 - PENDENTE
1 - ARPROVADO
2 - NÃO APROVADO';
ALTER TABLE STATUS_CONTROLE_APROVACAO ADD CONSTRAINT PK__STS_CTR_APR PRIMARY KEY ( ID );


ALTER TABLE CONTROLE_APROVACAO
    ADD CONSTRAINT FK__CTR_APR__PER FOREIGN KEY ( ID_PERFIL )
        REFERENCES PERFIL ( ID_PERFIL );

ALTER TABLE CONTROLE_APROVACAO
    ADD CONSTRAINT FK__CTR_APR__RGR FOREIGN KEY ( ID_REGRA )
        REFERENCES REGRA ( ID );

ALTER TABLE CONTROLE_APROVACAO
    ADD CONSTRAINT FK__CTR_APR__STS_CTR_APR FOREIGN KEY ( ID_STATUS_CONTROLE_APROVACAO )
        REFERENCES STATUS_CONTROLE_APROVACAO ( ID );

ALTER TABLE CONTROLE_APROVACAO
    ADD CONSTRAINT FK__CTR_APR__USR FOREIGN KEY ( ID_USUARIO )
        REFERENCES USUARIO ( ID_USUARIO );

ALTER TABLE FLUXO_PEDIDO_DE_PARA
    ADD CONSTRAINT FK__FLX_PED_DE_PARA__FLX_STS_PED_DE FOREIGN KEY ( ID_STATUS_PEDIDO_DE )
        REFERENCES STATUS_PEDIDO ( ID );

ALTER TABLE FLUXO_PEDIDO_DE_PARA
    ADD CONSTRAINT FK__FLX_PED_DE_PARA__FLX_STS_PED_PARA FOREIGN KEY ( ID_STATUS_PEDIDO_PARA )
        REFERENCES STATUS_PEDIDO ( ID );

ALTER TABLE PEDIDO_CONTROLE_APROVACAO
    ADD CONSTRAINT FK__PED_CTR_APR__CRT_APR FOREIGN KEY ( ID_CONTROLE_APROVACAO )
        REFERENCES CONTROLE_APROVACAO ( ID );

ALTER TABLE PEDIDO_CONTROLE_APROVACAO
    ADD CONSTRAINT FK__PED_CTR_APR__PED FOREIGN KEY ( ID_PEDIDO )
        REFERENCES PEDIDO ( ID_PEDIDO );

ALTER TABLE PERFIL_STATUS_PEDIDO
    ADD CONSTRAINT FK__PER_STS_PED__PER FOREIGN KEY ( ID_PERFIL )
        REFERENCES PERFIL ( ID_PERFIL );

ALTER TABLE PERFIL_STATUS_PEDIDO
    ADD CONSTRAINT FK__PER_STS_PED__STS_PED FOREIGN KEY ( ID_STATUS_PEDIDO )
        REFERENCES STATUS_PEDIDO ( ID );

ALTER TABLE REGRA_APROVACAO_COR
    ADD CONSTRAINT FK__RGR_APR_COR__RGR FOREIGN KEY ( ID )
        REFERENCES REGRA ( ID );

ALTER TABLE REGRA_APROVACAO_PRAZO
    ADD CONSTRAINT FK__RGR_APR_PRZ__RGR FOREIGN KEY ( ID )
        REFERENCES REGRA ( ID );

ALTER TABLE REGRA_APROVACAO_PRAZO
    ADD CONSTRAINT FK__RGR_APR_PRZ__USR FOREIGN KEY ( ID_USUARIO )
        REFERENCES USUARIO ( ID_USUARIO );

ALTER TABLE REGRA_APROVACAO_TABELA
    ADD CONSTRAINT FK__RGR_APR_TBL__RGR FOREIGN KEY ( ID )
        REFERENCES REGRA ( ID );

ALTER TABLE CONTROLE_APROVACAO
    ADD CONSTRAINT FK__CTR_APR__PER FOREIGN KEY ( ID_PERFIL )
        REFERENCES PERFIL ( ID_PERFIL );

ALTER TABLE CONTROLE_APROVACAO
    ADD CONSTRAINT FK__CTR_APR__RGR FOREIGN KEY ( ID_REGRA )
        REFERENCES REGRA ( ID );

ALTER TABLE CONTROLE_APROVACAO
    ADD CONSTRAINT FK__CTR_APR__STS_CTR_APR FOREIGN KEY ( ID_STATUS_CONTROLE_APROVACAO )
        REFERENCES STATUS_CONTROLE_APROVACAO ( ID );

ALTER TABLE CONTROLE_APROVACAO
    ADD CONSTRAINT FK__CTR_APR__USR FOREIGN KEY ( ID_USUARIO )
        REFERENCES USUARIO ( ID_USUARIO );

--  ERROR: FK NAME LENGTH EXCEEDS MAXIMUM ALLOWED LENGTH(30) 
ALTER TABLE FLUXO_PEDIDO_DE_PARA
    ADD CONSTRAINT FK__FLX_PED_DE_PARA__FLX_STS_PED_DE FOREIGN KEY ( ID_STATUS_PEDIDO_DE )
        REFERENCES STATUS_PEDIDO ( ID );

--  ERROR: FK NAME LENGTH EXCEEDS MAXIMUM ALLOWED LENGTH(30) 
ALTER TABLE FLUXO_PEDIDO_DE_PARA
    ADD CONSTRAINT FK__FLX_PED_DE_PARA__FLX_STS_PED_PARA FOREIGN KEY ( ID_STATUS_PEDIDO_PARA )
        REFERENCES STATUS_PEDIDO ( ID );

ALTER TABLE PEDIDO_CONTROLE_APROVACAO
    ADD CONSTRAINT FK__PED_CTR_APR__CRT_APR FOREIGN KEY ( ID_CONTROLE_APROVACAO )
        REFERENCES CONTROLE_APROVACAO ( ID );

ALTER TABLE PEDIDO_CONTROLE_APROVACAO
    ADD CONSTRAINT FK__PED_CTR_APR__PED FOREIGN KEY ( ID_PEDIDO )
        REFERENCES PEDIDO ( ID_PEDIDO );

ALTER TABLE PERFIL_STATUS_PEDIDO
    ADD CONSTRAINT FK__PER_STS_PED__PER FOREIGN KEY ( ID_PERFIL )
        REFERENCES PERFIL ( ID_PERFIL );

ALTER TABLE PERFIL_STATUS_PEDIDO
    ADD CONSTRAINT FK__PER_STS_PED__STS_PED FOREIGN KEY ( ID_STATUS_PEDIDO )
        REFERENCES STATUS_PEDIDO ( ID );

ALTER TABLE REGRA_APROVACAO_COR
    ADD CONSTRAINT FK__RGR_APR_COR__RGR FOREIGN KEY ( ID )
        REFERENCES REGRA ( ID );

ALTER TABLE REGRA_APROVACAO_PRAZO
    ADD CONSTRAINT FK__RGR_APR_PRZ__RGR FOREIGN KEY ( ID )
        REFERENCES REGRA ( ID );

ALTER TABLE REGRA_APROVACAO_PRAZO
    ADD CONSTRAINT FK__RGR_APR_PRZ__USR FOREIGN KEY ( ID_USUARIO )
        REFERENCES USUARIO ( ID_USUARIO );

ALTER TABLE REGRA_APROVACAO_TABELA
    ADD CONSTRAINT FK__RGR_APR_TBL__RGR FOREIGN KEY ( ID )
        REFERENCES REGRA ( ID );



-- ORACLE SQL DEVELOPER DATA MODELER SUMMARY REPORT: 
-- 
-- CREATE TABLE                            13
-- CREATE INDEX                             0
-- ALTER TABLE                             41
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- REDACTION POLICY                         0
-- 
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0
